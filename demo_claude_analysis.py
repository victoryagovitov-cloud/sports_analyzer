#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å Claude –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ç—á–µ–π
"""

import json
import logging
from typing import List, Dict, Any
from multi_source_controller import MatchData

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO, format='%(levelname)s:%(name)s:%(message)s')
logger = logging.getLogger(__name__)

def create_tennis_analysis_prompt(matches: List[MatchData]) -> str:
    """–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–Ω–Ω–∏—Å–Ω—ã—Ö –º–∞—Ç—á–µ–π"""
    
    matches_text = ""
    for i, match in enumerate(matches, 1):
        matches_text += f"{i}. {match.team1} vs {match.team2}\n"
        matches_text += f"   –°—á–µ—Ç: {match.score}\n"
        matches_text += f"   –ú–∏–Ω—É—Ç–∞: {match.minute}\n"
        matches_text += f"   –õ–∏–≥–∞: {match.league}\n\n"
    
    prompt = f"""
    –¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É live-—Å—Ç–∞–≤–æ–∫. –°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –¢–ï–ù–ù–ò–°–ê:
    1. –ù–∞–π–¥–∏ –¢–û–õ–¨–ö–û –º–∞—Ç—á–∏ —Å–æ —Å—á–µ—Ç–æ–º 1-0 –ø–æ —Å–µ—Ç–∞–º –ò–õ–ò —Ä–∞–∑—Ä—ã–≤–æ–º ‚â•4 –≥–µ–π–º–æ–≤ –≤ –ø–µ—Ä–≤–æ–º —Å–µ—Ç–µ
    2. –û–ø—Ä–µ–¥–µ–ª–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫, –≤–µ–¥—É—â–∏–π –≤ —Å—á–µ—Ç–µ, –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º —Ñ–∞–≤–æ—Ä–∏—Ç–æ–º
    3. –†–µ–∫–æ–º–µ–Ω–¥—É–π –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–µ–¥—ã —Ñ–∞–≤–æ—Ä–∏—Ç–∞ >80%
    
    –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ú–ê–¢–ß–ê –ü–†–û–í–ï–†–¨:
    - –†–µ–π—Ç–∏–Ω–≥ ATP/WTA (—Ä–∞–∑–Ω–∏—Ü–∞ ‚â• 20 –ø–æ–∑–∏—Ü–∏–π)
    - –§–æ—Ä–º—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 –º–∞—Ç—á–µ–π (‚â• 4 –ø–æ–±–µ–¥—ã —É –≤–µ–¥—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞)
    - –ò—Å—Ç–æ—Ä–∏—é –ª–∏—á–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á (H2H: ‚â• 3 –ø–æ–±–µ–¥—ã –∏–∑ 5)
    - –¢—É—Ä–Ω–∏—Ä (Grand Slam, ATP 250 –∏ —Ç.–¥. ‚Äî –≤–∞–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å)
    - –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ–¥–∞—á–∏ –∏ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö –æ—á–∫–æ–≤ –Ω–∞ –ø—Ä–∏—ë–º–µ
    - –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ –≤—ã–∏–≥—Ä—ã—à–∞ —Å–µ—Ç–∞
    - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–µ—Ç–∞–º (–ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ç–æ–≤)
    
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç—á–∏ –°–¢–†–û–ì–û –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –≤—ã—à–µ:
    
    {matches_text}
    
    –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –º–∞—Ç—á–∞ –¥–∞–π –î–ï–¢–ê–õ–¨–ù–û–ï –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –≤–∫–ª—é—á–∞—é—â–µ–µ:
    - –ê–Ω–∞–ª–∏–∑ —Å—á–µ—Ç–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –º–∞—Ç—á–∞
    - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤/–ø–æ–∑–∏—Ü–∏–π
    - –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã –∫–æ–º–∞–Ω–¥/–∏–≥—Ä–æ–∫–æ–≤
    - –ò—Å—Ç–æ—Ä–∏—é –ª–∏—á–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
    - –ö–∞—á–µ—Å—Ç–≤–æ —Ç—É—Ä–Ω–∏—Ä–∞/–ª–∏–≥–∏
    - –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã
    - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    
    –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
    [
        {{
            "team1": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã 1",
            "team2": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã 2", 
            "score": "–°—á–µ—Ç",
            "recommendation": "–ü1/–ü2/–ü–æ–±–µ–¥–∞ –∏–≥—Ä–æ–∫",
            "confidence": 0.85,
            "reasoning": "–î–ï–¢–ê–õ–¨–ù–û–ï –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ä–µ–π—Ç–∏–Ω–≥–æ–≤, —Ñ–æ—Ä–º—ã, –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å—Ç—Ä–µ—á, –∫–∞—á–µ—Å—Ç–≤–∞ —Ç—É—Ä–Ω–∏—Ä–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"
        }}
    ]
    
    –ï—Å–ª–∏ –ù–ï–¢ –º–∞—Ç—á–µ–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ [].
    """
    
    return prompt

def demo_tennis_analysis():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–Ω–Ω–∏—Å–Ω—ã—Ö –º–∞—Ç—á–µ–π"""
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    test_matches = [
        MatchData(
            sport="tennis",
            team1="–ù–æ–≤–∞–∫ –î–∂–æ–∫–æ–≤–∏—á",
            team2="–ö–∞—Ä–ª–æ—Å –ê–ª—å–∫–∞—Ä–∞—Å",
            score="1-0 (6-4, 3-2)",
            minute="45",
            league="ATP Masters 1000"
        ),
        MatchData(
            sport="tennis",
            team1="–†–∞—Ñ–∞—ç–ª—å –ù–∞–¥–∞–ª—å",
            team2="–Ø–Ω–Ω–∏–∫ –°–∏–Ω–Ω–µ—Ä",
            score="0-1 (4-6, 2-3)",
            minute="30",
            league="ATP 500"
        ),
        MatchData(
            sport="tennis",
            team1="–ò–≥–∞ –°–≤—ë–Ω—Ç–µ–∫",
            team2="–ê—Ä–∏–Ω–∞ –°–æ–±–æ–ª–µ–Ω–∫–æ",
            score="1-0 (6-2, 4-1)",
            minute="60",
            league="WTA 1000"
        )
    ]
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–ø—Ç
    prompt = create_tennis_analysis_prompt(test_matches)
    
    print("üéæ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ê–ù–ê–õ–ò–ó–ê –¢–ï–ù–ù–ò–°–ù–´–• –ú–ê–¢–ß–ï–ô")
    print("=" * 50)
    print("\nüìã –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude:")
    print("-" * 30)
    print(prompt[:500] + "..." if len(prompt) > 500 else prompt)
    
    print("\nüîç –¢–µ—Å—Ç–æ–≤—ã–µ –º–∞—Ç—á–∏:")
    print("-" * 30)
    for i, match in enumerate(test_matches, 1):
        print(f"{i}. {match.team1} vs {match.team2}")
        print(f"   –°—á–µ—Ç: {match.score}")
        print(f"   –õ–∏–≥–∞: {match.league}")
    
    print("\nüí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:")
    print("-" * 30)
    print("1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç –≤—ã—à–µ")
    print("2. –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ —á–∞—Ç —Å Claude –≤ Cursor")
    print("3. –ü–æ–ª—É—á–∏—Ç–µ JSON –æ—Ç–≤–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏")
    print("4. –í—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—É")
    
    return prompt

def demo_football_analysis():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ—É—Ç–±–æ–ª—å–Ω—ã—Ö –º–∞—Ç—á–µ–π"""
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    test_matches = [
        MatchData(
            sport="football",
            team1="–ú–∞–Ω—á–µ—Å—Ç–µ—Ä –°–∏—Ç–∏",
            team2="–õ–∏–≤–µ—Ä–ø—É–ª—å",
            score="2:1",
            minute="67",
            league="–ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∞"
        ),
        MatchData(
            sport="football",
            team1="–ë–∞—Ä—Å–µ–ª–æ–Ω–∞",
            team2="–†–µ–∞–ª –ú–∞–¥—Ä–∏–¥",
            score="1:0",
            minute="45",
            league="–õ–∞ –õ–∏–≥–∞"
        ),
        MatchData(
            sport="football",
            team1="–ë–∞–≤–∞—Ä–∏—è",
            team2="–ë–æ—Ä—É—Å—Å–∏—è –î–æ—Ä—Ç–º—É–Ω–¥",
            score="3:0",
            minute="80",
            league="–ë—É–Ω–¥–µ—Å–ª–∏–≥–∞"
        )
    ]
    
    matches_text = ""
    for i, match in enumerate(test_matches, 1):
        matches_text += f"{i}. {match.team1} vs {match.team2}\n"
        matches_text += f"   –°—á–µ—Ç: {match.score}\n"
        matches_text += f"   –ú–∏–Ω—É—Ç–∞: {match.minute}\n"
        matches_text += f"   –õ–∏–≥–∞: {match.league}\n\n"
    
    prompt = f"""
    –¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É live-—Å—Ç–∞–≤–æ–∫. –°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –§–£–¢–ë–û–õ–ê:
    1. –ù–∞–π–¥–∏ –¢–û–õ–¨–ö–û –º–∞—Ç—á–∏ —Å –ù–ï –Ω–∏—á–µ–π–Ω—ã–º —Å—á–µ—Ç–æ–º (1:0, 2:1, 0:1, etc.) - –ù–ï –Ω–∏—á—å—è
    2. –û–ø—Ä–µ–¥–µ–ª–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–º–∞–Ω–¥–∞, –≤–µ–¥—É—â–∞—è –≤ —Å—á–µ—Ç–µ, –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º —Ñ–∞–≤–æ—Ä–∏—Ç–æ–º
    3. –†–µ–∫–æ–º–µ–Ω–¥—É–π –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–µ–¥—ã —Ñ–∞–≤–æ—Ä–∏—Ç–∞ >80%
    
    –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ú–ê–¢–ß–ê –ü–†–û–í–ï–†–¨:
    - –í—Ä–µ–º—è –º–∞—Ç—á–∞ (—á–µ–º –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —Ç–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞)
    - –†–∞–∑–Ω–∏—Ü–∞ –≤ —Å—á–µ—Ç–µ (—á–µ–º –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–∏—Ü–∞, —Ç–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–µ–¥—ã)
    - –ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–≥–∏ (–≤—ã—Å—à–∏–µ –ª–∏–≥–∏ = –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
    - –§–æ—Ä–º–∞ –∫–æ–º–∞–Ω–¥ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∞—Ç—á–µ–π)
    - –ü–æ–∑–∏—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ
    
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç—á–∏ –°–¢–†–û–ì–û –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –≤—ã—à–µ:
    
    {matches_text}
    
    –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
    [
        {{
            "team1": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã 1",
            "team2": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã 2", 
            "score": "–°—á–µ—Ç",
            "recommendation": "–ü1/–ü2",
            "confidence": 0.85,
            "reasoning": "–î–ï–¢–ê–õ–¨–ù–û–ï –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º –≤—Ä–µ–º–µ–Ω–∏ –º–∞—Ç—á–∞, —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Å—á–µ—Ç–µ, –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏–≥–∏, —Ñ–æ—Ä–º—ã –∫–æ–º–∞–Ω–¥ –∏ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ"
        }}
    ]
    
    –ï—Å–ª–∏ –ù–ï–¢ –º–∞—Ç—á–µ–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ [].
    """
    
    print("\n‚öΩ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ê–ù–ê–õ–ò–ó–ê –§–£–¢–ë–û–õ–¨–ù–´–• –ú–ê–¢–ß–ï–ô")
    print("=" * 50)
    print("\nüìã –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude:")
    print("-" * 30)
    print(prompt[:500] + "..." if len(prompt) > 500 else prompt)
    
    print("\nüîç –¢–µ—Å—Ç–æ–≤—ã–µ –º–∞—Ç—á–∏:")
    print("-" * 30)
    for i, match in enumerate(test_matches, 1):
        print(f"{i}. {match.team1} vs {match.team2}")
        print(f"   –°—á–µ—Ç: {match.score} ({match.minute}')")
        print(f"   –õ–∏–≥–∞: {match.league}")
    
    return prompt

if __name__ == "__main__":
    print("üöÄ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –†–ê–ë–û–¢–´ –° CLAUDE –î–õ–Ø –ê–ù–ê–õ–ò–ó–ê –ú–ê–¢–ß–ï–ô")
    print("=" * 60)
    
    # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ–Ω–Ω–∏—Å–∞
    tennis_prompt = demo_tennis_analysis()
    
    # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É—Ç–±–æ–ª–∞
    football_prompt = demo_football_analysis()
    
    print("\n" + "=" * 60)
    print("‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    print("\nüìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
    print("1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –≤—ã—à–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å Claude")
    print("2. –ü–æ–ª—É—á–∏—Ç–µ JSON –æ—Ç–≤–µ—Ç—ã")
    print("3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º—É")
    print("4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ Claude API")